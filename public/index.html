<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé¨ Mr.Boombastic Downloader Web</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Estilos adicionais */
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
        
        .status-dot.online {
            background: #2ecc71;
            box-shadow: 0 0 10px rgba(46, 204, 113, 0.5);
        }
        
        .status-dot.offline {
            background: #e74c3c;
            box-shadow: 0 0 10px rgba(231, 76, 60, 0.5);
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        @keyframes slideIn {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .loading {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            background: rgba(30, 40, 50, 0.8);
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .loading.active {
            display: flex;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(52, 152, 219, 0.2);
            border-top: 4px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .video-info, .formats-section {
            display: none;
        }
        
        .video-info.active, .formats-section.active {
            display: block;
            animation: slideIn 0.5s ease;
        }
        
        .status-message {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-family: Arial, sans-serif;
            z-index: 1000;
            max-width: 400px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            display: none;
            align-items: center;
            gap: 10px;
            animation: slideIn 0.3s ease;
        }
        
        .status-message.active {
            display: flex;
        }
        
        .status-message.success {
            background: linear-gradient(45deg, #27ae60, #219653);
        }
        
        .status-message.error {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }
        
        .status-message.info {
            background: linear-gradient(45deg, #3498db, #2980b9);
        }
        
        .btn-close {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.2em;
            padding: 0 5px;
            opacity: 0.8;
        }
        
        .btn-close:hover {
            opacity: 1;
        }
        
        .format-type {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            display: inline-block;
        }
        
        .format-type.video-audio {
            background: rgba(46, 204, 113, 0.2);
            color: #2ecc71;
            border: 1px solid rgba(46, 204, 113, 0.3);
        }
        
        .format-type.video {
            background: rgba(52, 152, 219, 0.2);
            color: #3498db;
            border: 1px solid rgba(52, 152, 219, 0.3);
        }
        
        .format-type.audio {
            background: rgba(155, 89, 182, 0.2);
            color: #9b59b6;
            border: 1px solid rgba(155, 89, 182, 0.3);
        }
        
        .download-btn {
            padding: 8px 15px;
            background: linear-gradient(45deg, #27ae60, #219653);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .download-btn:hover {
            background: linear-gradient(45deg, #219653, #1e8449);
            transform: translateY(-2px);
        }
        
        .btn-action {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 5px;
        }
        
        .btn-best {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
        }
        
        .btn-audio {
            background: linear-gradient(45deg, #9b59b6, #8e44ad);
            color: white;
        }
        
        .btn-mp3 {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
        }
        
        .btn-action:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        /* Responsividade */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .input-group {
                flex-direction: column;
            }
            
            #urlInput, #loadBtn {
                width: 100%;
            }
            
            .quick-actions {
                flex-direction: column;
            }
            
            .btn-action {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <i class="fas fa-film"></i>
                <h1>Mr.Boombastic Downloader</h1>
            </div>
            <p class="subtitle">Obtenha informa√ß√µes de qualquer v√≠deo do YouTube</p>
            <div class="status-badge" id="apiStatus">
                <span class="status-dot"></span>
                <span class="status-text">Conectando...</span>
            </div>
        </header>

        <!-- Main Input Section -->
        <section class="input-section">
            <div class="input-group">
                <i class="fas fa-link input-icon"></i>
                <input 
                    type="text" 
                    id="urlInput" 
                    placeholder="Cole a URL do YouTube aqui (ex: https://www.youtube.com/watch?v=...)"
                    autocomplete="off"
                    value="https://www.youtube.com/watch?v=dQw4w9WgXcQ"
                >
                <button id="loadBtn" class="btn btn-primary">
                    <i class="fas fa-search"></i>
                    <span>Carregar Informa√ß√µes</span>
                </button>
            </div>
            
            <div class="quick-links">
                <button class="quick-link" onclick="useExample()">
                    <i class="fas fa-magic"></i> URL de Exemplo
                </button>
                <button class="quick-link" onclick="testAPI()">
                    <i class="fas fa-bolt"></i> Testar API
                </button>
                <button class="quick-link" onclick="clearAll()">
                    <i class="fas fa-trash"></i> Limpar Tudo
                </button>
                <button class="quick-link" onclick="testAllEndpoints()">
                    <i class="fas fa-vial"></i> Diagn√≥stico
                </button>
            </div>
        </section>

        <!-- Loading Indicator -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p id="loadingText">Processando...</p>
        </div>

        <!-- Video Info Section -->
        <section class="video-info" id="videoInfo">
            <div class="info-header">
                <h2 id="videoTitle">T√≠tulo do V√≠deo</h2>
                <div class="info-badges">
                    <span class="badge" id="videoDuration">
                        <i class="fas fa-clock"></i> 00:00
                    </span>
                    <span class="badge" id="videoViews">
                        <i class="fas fa-eye"></i> 0 views
                    </span>
                    <span class="badge" id="videoAuthor">
                        <i class="fas fa-user"></i> Autor
                    </span>
                    <span class="badge" id="videoFormats">
                        <i class="fas fa-layer-group"></i> 0 formatos
                    </span>
                </div>
            </div>

            <div class="info-content">
                <div class="thumbnail-container">
                    <img id="videoThumbnail" src="" alt="Thumbnail" class="thumbnail">
                    <div class="thumbnail-overlay">
                        <button class="btn-thumbnail" onclick="copyURL()">
                            <i class="fas fa-copy"></i> Copiar URL
                        </button>
                    </div>
                </div>

                <div class="details">
                    <div class="detail-item">
                        <label><i class="fas fa-calendar"></i> Data:</label>
                        <span id="uploadDate">--</span>
                    </div>
                    <div class="detail-item">
                        <label><i class="fas fa-heart"></i> Likes:</label>
                        <span id="likeCount">--</span>
                    </div>
                    <div class="detail-item">
                        <label><i class="fas fa-database"></i> Qualidade:</label>
                        <span id="bestQuality">--</span>
                    </div>
                    <div class="detail-item description">
                        <label><i class="fas fa-info-circle"></i> Status:</label>
                        <p id="apiMode">Carregando informa√ß√µes...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Formats Table -->
        <section class="formats-section" id="formatsSection">
            <div class="section-header">
                <h3><i class="fas fa-list"></i> Formatos Dispon√≠veis</h3>
                <div class="format-filters" id="formatFilters">
                    <button class="filter-btn active" onclick="filterFormats('all')">Todos</button>
                    <button class="filter-btn" onclick="filterFormats('video+audio')">V√≠deo+√Åudio</button>
                    <button class="filter-btn" onclick="filterFormats('video')">Apenas V√≠deo</button>
                    <button class="filter-btn" onclick="filterFormats('audio')">Apenas √Åudio</button>
                </div>
            </div>

            <div class="table-container">
                <table class="formats-table">
                    <thead>
                        <tr>
                            <th>Tipo</th>
                            <th>Resolu√ß√£o/Qualidade</th>
                            <th>Formato</th>
                            <th>Tamanho</th>
                            <th>Codec</th>
                            <th>A√ß√£o</th>
                        </tr>
                    </thead>
                    <tbody id="formatsTableBody">
                        <!-- Formatos ser√£o inseridos aqui -->
                    </tbody>
                </table>
                <div id="noFormats" style="display: none; text-align: center; padding: 20px; color: #95a5a6;">
                    <i class="fas fa-info-circle" style="font-size: 2em; margin-bottom: 10px;"></i>
                    <p>Nenhum formato dispon√≠vel ou ainda carregando...</p>
                </div>
            </div>

            <div class="quick-actions">
                <button class="btn-action btn-best" onclick="downloadBest()">
                    <i class="fas fa-crown"></i> Melhor Qualidade
                </button>
                <button class="btn-action btn-audio" onclick="downloadAudio()">
                    <i class="fas fa-music"></i> Melhor √Åudio
                </button>
                <button class="btn-action btn-mp3" onclick="convertToMP3()">
                    <i class="fas fa-file-audio"></i> Converter para MP3
                </button>
            </div>
        </section>

        <!-- Footer -->
        <footer class="footer">
            <p>
                <i class="fas fa-exclamation-triangle"></i>
                <strong>Aviso:</strong> Para fins educacionais. Respeite os Termos do YouTube.
            </p>
            <div class="footer-links">
                <span>Status: <strong id="footerStatus">Checking...</strong></span>
                <span>‚Ä¢</span>
                <a href="/api/test" target="_blank">API Test</a>
                <span>‚Ä¢</span>
                <a href="/api/health" target="_blank">Health</a>
                <span>‚Ä¢</span>
                <span id="apiVersion">v1.0</span>
            </div>
        </footer>
    </div>

    <!-- Status Message (din√¢mico) -->
    <div class="status-message" id="statusMessage">
        <div class="message-content">
            <i class="fas fa-info-circle" id="messageIcon"></i>
            <span id="messageText">Pronto para come√ßar</span>
        </div>
        <button class="btn-close" onclick="hideMessage()">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <script>
    // ==================== CONFIGURA√á√ÉO ====================
    const API_ENDPOINTS = {
        test: '/api/test',
        health: '/api/health',
        debug: '/api/debug',
        simple: '/api/simple',
        info: '/api/info'
    };
    
    let currentVideoData = null;
    let allFormats = [];
    
    // ==================== FUN√á√ïES DE UTILIDADE ====================
    function showMessage(text, type = 'info', duration = 5000) {
        const messageDiv = document.getElementById('statusMessage');
        const messageText = document.getElementById('messageText');
        const messageIcon = document.getElementById('messageIcon');
        
        if (!messageDiv || !messageText || !messageIcon) return;
        
        // Definir classe e √≠cone baseado no tipo
        messageDiv.className = 'status-message active ' + type;
        
        const icons = {
            success: 'fa-check-circle',
            error: 'fa-exclamation-circle',
            info: 'fa-info-circle',
            warning: 'fa-exclamation-triangle'
        };
        
        messageIcon.className = 'fas ' + (icons[type] || icons.info);
        messageText.textContent = text;
        
        // Auto-esconder
        if (duration > 0) {
            setTimeout(() => {
                messageDiv.classList.remove('active');
            }, duration);
        }
    }
    
    function hideMessage() {
        const messageDiv = document.getElementById('statusMessage');
        if (messageDiv) {
            messageDiv.classList.remove('active');
        }
    }
    
    function showLoading(text = 'Processando...') {
        const loadingDiv = document.getElementById('loading');
        const loadingText = document.getElementById('loadingText');
        if (loadingDiv && loadingText) {
            loadingText.textContent = text;
            loadingDiv.classList.add('active');
        }
    }
    
    function hideLoading() {
        const loadingDiv = document.getElementById('loading');
        if (loadingDiv) {
            loadingDiv.classList.remove('active');
        }
    }
    
    function updateStatus(status, color = '#3498db') {
        const statusDot = document.querySelector('.status-dot');
        const statusText = document.querySelector('.status-text');
        const footerStatus = document.getElementById('footerStatus');
        
        if (statusDot) {
            statusDot.className = 'status-dot ' + (status === 'online' ? 'online' : 'offline');
        }
        if (statusText) {
            statusText.textContent = status === 'online' ? 'API Online' : 'API Offline';
            statusText.style.color = status === 'online' ? '#2ecc71' : '#e74c3c';
        }
        if (footerStatus) {
            footerStatus.textContent = status === 'online' ? 'Online' : 'Offline';
            footerStatus.style.color = status === 'online' ? '#2ecc71' : '#e74c3c';
        }
    }
    
    // ==================== FUN√á√ïES DE API ====================
    async function testAPIConnection() {
        try {
            console.log('üîç Testando conex√£o com API...');
            const response = await fetch(API_ENDPOINTS.test);
            
            if (response.ok) {
                const data = await response.json();
                console.log('‚úÖ API Online:', data);
                updateStatus('online');
                return true;
            } else {
                throw new Error(`HTTP ${response.status}`);
            }
        } catch (error) {
            console.error('‚ùå Erro na API:', error);
            updateStatus('offline');
            return false;
        }
    }
    
    async function testAllEndpoints() {
        showLoading('Executando diagn√≥sticos...');
        const testUrl = encodeURIComponent('https://www.youtube.com/watch?v=dQw4w9WgXcQ');
        const results = [];
        
        const endpoints = [
            { name: 'Teste B√°sico', url: API_ENDPOINTS.test },
            { name: 'Health Check', url: API_ENDPOINTS.health },
            { name: 'Debug Info', url: `${API_ENDPOINTS.debug}?url=${testUrl}` },
            { name: 'Endpoint Simples', url: `${API_ENDPOINTS.simple}?url=${testUrl}` },
            { name: 'Endpoint Completo', url: `${API_ENDPOINTS.info}?url=${testUrl}` }
        ];
        
        for (const endpoint of endpoints) {
            try {
                console.log(`üß™ Testando: ${endpoint.name}`);
                const response = await fetch(endpoint.url);
                const data = await response.json();
                
                const result = {
                    name: endpoint.name,
                    status: response.ok ? '‚úÖ' : '‚ùå',
                    data: data
                };
                
                results.push(result);
                console.log(`${result.status} ${endpoint.name}:`, data);
                
            } catch (error) {
                results.push({
                    name: endpoint.name,
                    status: 'üí•',
                    error: error.message
                });
                console.log(`üí• ${endpoint.name}:`, error);
            }
        }
        
        hideLoading();
        
        // Mostrar resumo
        let message = 'Diagn√≥stico completo:\n';
        results.forEach(r => {
            message += `${r.status} ${r.name}\n`;
        });
        
        showMessage(message, 'info', 8000);
        
        // Se algum endpoint funcionar, atualizar status
        const workingEndpoints = results.filter(r => r.status === '‚úÖ');
        if (workingEndpoints.length > 0) {
            updateStatus('online');
        }
        
        return results;
    }
    
    async function loadVideoInfo() {
        const urlInput = document.getElementById('urlInput');
        const url = urlInput.value.trim();
        
        if (!url) {
            showMessage('‚ùå Por favor, insira uma URL do YouTube', 'error');
            return;
        }
        
        // Validar URL do YouTube
        if (!url.includes('youtube.com') && !url.includes('youtu.be')) {
            showMessage('‚ö†Ô∏è Isso n√£o parece ser uma URL do YouTube v√°lida', 'warning');
        }
        
        showLoading('Carregando informa√ß√µes do v√≠deo...');
        
        // Primeiro tente o endpoint simples
        try {
            const encodedUrl = encodeURIComponent(url);
            
            // Tentar endpoint simples primeiro
            let response = await fetch(`${API_ENDPOINTS.simple}?url=${encodedUrl}`);
            let data = await response.json();
            
            console.log('üìä Resposta (simples):', data);
            
            if (data.success) {
                // Marcar que estamos usando dados simples
                data._mode = 'simple';
                processVideoData(data);
                showMessage(`‚úÖ ${data.formats?.length || 0} formatos carregados (modo simples)`, 'success');
                
                // Tentar endpoint completo em segundo plano
                setTimeout(async () => {
                    try {
                        const fullResponse = await fetch(`${API_ENDPOINTS.info}?url=${encodedUrl}`);
                        const fullData = await fullResponse.json();
                        
                        if (fullData.success) {
                            console.log('üìä Resposta (completa):', fullData);
                            fullData._mode = 'full';
                            processVideoData(fullData);
                            showMessage(`‚úÖ Atualizado! ${fullData.formats?.length} formatos dispon√≠veis`, 'success');
                        }
                    } catch (e) {
                        console.log('‚ö†Ô∏è Endpoint completo n√£o dispon√≠vel, mantendo dados simples');
                    }
                }, 500);
                
            } else {
                // Se simples falhar, tentar endpoint completo
                response = await fetch(`${API_ENDPOINTS.info}?url=${encodedUrl}`);
                data = await response.json();
                
                if (data.success) {
                    data._mode = 'full';
                    processVideoData(data);
                    showMessage(`‚úÖ ${data.formats?.length || 0} formatos carregados`, 'success');
                } else {
                    showMessage(`‚ùå ${data.error || data.detail || 'Falha ao carregar v√≠deo'}`, 'error');
                }
            }
        } catch (error) {
            console.error('üí• Erro:', error);
            showMessage(`üí• Falha de conex√£o: ${error.message}`, 'error');
        } finally {
            hideLoading();
        }
    }
    
    // ==================== PROCESSAMENTO DE DADOS ====================
    function processVideoData(data) {
        currentVideoData = data;
        allFormats = data.formats || [];
        
        // Atualizar informa√ß√µes b√°sicas
        updateBasicInfo(data);
        
        // Atualizar tabela de formatos
        updateFormatsTable(allFormats);
        
        // Mostrar se√ß√µes
        document.getElementById('videoInfo').classList.add('active');
        document.getElementById('formatsSection').classList.add('active');
        
        // Atualizar modo da API
        const apiMode = document.getElementById('apiMode');
        if (apiMode) {
            apiMode.textContent = data._mode === 'simple' ? 
                'Modo Simples (algumas informa√ß√µes podem estar limitadas)' : 
                'Modo Completo (todas informa√ß√µes dispon√≠veis)';
            apiMode.style.color = data._mode === 'simple' ? '#f39c12' : '#2ecc71';
        }
    }
    
    function updateBasicInfo(data) {
        // T√≠tulo
        const titleEl = document.getElementById('videoTitle');
        if (titleEl && data.title) {
            titleEl.textContent = data.title.length > 60 ? data.title.substring(0, 60) + '...' : data.title;
        }
        
        // Autor
        const authorEl = document.getElementById('videoAuthor');
        if (authorEl && data.author) {
            authorEl.innerHTML = `<i class="fas fa-user"></i> ${data.author}`;
        }
        
        // Dura√ß√£o
        const durationEl = document.getElementById('videoDuration');
        if (durationEl && data.duration) {
            const minutes = Math.floor(data.duration / 60);
            const seconds = data.duration % 60;
            durationEl.innerHTML = `<i class="fas fa-clock"></i> ${minutes}:${seconds.toString().padStart(2, '0')}`;
        }
        
        // Views
        const viewsEl = document.getElementById('videoViews');
        if (viewsEl && data.view_count) {
            const views = data.view_count > 1000 ? 
                (data.view_count / 1000).toFixed(1) + 'K' : 
                data.view_count.toString();
            viewsEl.innerHTML = `<i class="fas fa-eye"></i> ${views} views`;
        }
        
        // Likes
        const likesEl = document.getElementById('likeCount');
        if (likesEl && data.like_count) {
            likesEl.textContent = data.like_count.toLocaleString();
        }
        
        // Thumbnail
        const thumbnailEl = document.getElementById('videoThumbnail');
        if (thumbnailEl) {
            if (data.thumbnail) {
                thumbnailEl.src = data.thumbnail;
                thumbnailEl.style.display = 'block';
            } else {
                // Thumbnail padr√£o
                thumbnailEl.src = 'https://img.youtube.com/vi/dQw4w9WgXcQ/hqdefault.jpg';
            }
        }
        
        // Melhor qualidade
        const qualityEl = document.getElementById('bestQuality');
        if (qualityEl && data.best_video) {
            qualityEl.textContent = data.best_video.resolution || 'HD';
        }
        
        // Contagem de formatos
        const formatsEl = document.getElementById('videoFormats');
        if (formatsEl && data.formats) {
            formatsEl.innerHTML = `<i class="fas fa-layer-group"></i> ${data.formats.length} formatos`;
        }
    }
    
    function updateFormatsTable(formats) {
        const tableBody = document.getElementById('formatsTableBody');
        const noFormatsDiv = document.getElementById('noFormats');
        
        if (!tableBody || !noFormatsDiv) return;
        
        // Limpar tabela
        tableBody.innerHTML = '';
        
        if (!formats || formats.length === 0) {
            tableBody.style.display = 'none';
            noFormatsDiv.style.display = 'block';
            return;
        }
        
        tableBody.style.display = 'table-row-group';
        noFormatsDiv.style.display = 'none';
        
        // Adicionar cada formato
        formats.forEach((format, index) => {
            const row = document.createElement('tr');
            
            // Tipo
            let typeClass, typeIcon, typeText;
            if (format.type === 'video+audio') {
                typeClass = 'video-audio';
                typeIcon = 'üé¨+üéµ';
                typeText = 'V√≠deo+√Åudio';
            } else if (format.type === 'video') {
                typeClass = 'video';
                typeIcon = 'üé¨';
                typeText = 'V√≠deo';
            } else {
                typeClass = 'audio';
                typeIcon = 'üéµ';
                typeText = '√Åudio';
            }
            
            // Codec info
            let codecInfo = '--';
            if (format.codec) {
                const parts = [];
                if (format.codec.video && format.codec.video !== 'none') parts.push(format.codec.video);
                if (format.codec.audio && format.codec.audio !== 'none') parts.push(format.codec.audio);
                codecInfo = parts.join(' + ') || '--';
            }
            
            row.innerHTML = `
                <td>
                    <span class="format-type ${typeClass}" title="${typeText}">
                        ${typeIcon} ${typeText}
                    </span>
                </td>
                <td><strong>${format.resolution || 'N/A'}</strong> ${format.quality ? `(${format.quality})` : ''}</td>
                <td><code>.${format.ext || 'unknown'}</code></td>
                <td>${format.size_mb ? `<strong>${format.size_mb} MB</strong>` : 'N/A'}</td>
                <td><small>${codecInfo}</small></td>
                <td>
                    <button class="download-btn" onclick="downloadFormat('${format.id}', ${index})" title="Baixar este formato">
                        <i class="fas fa-download"></i> Baixar
                    </button>
                </td>
            `;
            
            tableBody.appendChild(row);
        });
    }
    
    function filterFormats(type) {
        const filterButtons = document.querySelectorAll('.filter-btn');
        filterButtons.forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        
        let filteredFormats = [];
        
        if (type === 'all') {
            filteredFormats = allFormats;
        } else {
            filteredFormats = allFormats.filter(f => f.type === type);
        }
        
        updateFormatsTable(filteredFormats);
        
        if (filteredFormats.length === 0 && allFormats.length > 0) {
            showMessage(`Nenhum formato do tipo "${type}" encontrado`, 'info', 3000);
        }
    }
    
    // ==================== FUN√á√ïES DE DOWNLOAD ====================
    function downloadFormat(formatId, index) {
        if (!currentVideoData) return;
        
        const format = allFormats[index];
        if (!format) return;
        
        showMessage(`üì• Preparando download: ${format.resolution || format.type} (${format.ext})`, 'info');
        
        // Simula√ß√£o de download (substituir por implementa√ß√£o real)
        setTimeout(() => {
            showMessage(`‚ö†Ô∏è Funcionalidade de download em desenvolvimento. ID: ${formatId}`, 'warning');
        }, 1000);
    }
    
    function downloadBest() {
        if (!currentVideoData || !currentVideoData.best_video) {
            showMessage('‚ùå Nenhum v√≠deo carregado para download', 'error');
            return;
        }
        
        showMessage(`üéØ Preparando melhor qualidade: ${currentVideoData.best_video.resolution}`, 'info');
        
        // Simula√ß√£o
        setTimeout(() => {
            showMessage('‚ö†Ô∏è Download da melhor qualidade em desenvolvimento', 'warning');
        }, 1000);
    }
    
    function downloadAudio() {
        if (!currentVideoData) {
            showMessage('‚ùå Nenhum v√≠deo carregado', 'error');
            return;
        }
        
        // Encontrar melhor √°udio
        const bestAudio = allFormats.filter(f => f.type === 'audio')
            .sort((a, b) => (b.size_mb || 0) - (a.size_mb || 0))[0];
        
        if (!bestAudio) {
            showMessage('‚ùå Nenhum formato de √°udio dispon√≠vel', 'error');
            return;
        }
        
        showMessage(`üéµ Preparando √°udio: ${bestAudio.ext.toUpperCase()} (${bestAudio.size_mb}MB)`, 'info');
        
        // Simula√ß√£o
        setTimeout(() => {
            showMessage('‚ö†Ô∏è Download de √°udio em desenvolvimento', 'warning');
        }, 1000);
    }
    
    function convertToMP3() {
        showMessage('‚ö†Ô∏è Convers√£o para MP3 em desenvolvimento', 'warning');
    }
    
    // ==================== FUN√á√ïES AUXILIARES ====================
    function useExample() {
        const urlInput = document.getElementById('urlInput');
        urlInput.value = 'https://www.youtube.com/watch?v=dQw4w9WgXcQ';
        showMessage('‚úÖ URL de exemplo inserida', 'success');
    }
    
    function testAPI() {
        testAPIConnection().then(isOnline => {
            if (isOnline) {
                showMessage('‚úÖ API online e funcionando!', 'success');
            } else {
                showMessage('‚ùå API offline. Verifique o servidor.', 'error');
            }
        });
    }
    
    function clearAll() {
        const urlInput = document.getElementById('urlInput');
        urlInput.value = '';
        
        document.getElementById('videoInfo').classList.remove('active');
        document.getElementById('formatsSection').classList.remove('active');
        
        currentVideoData = null;
        allFormats = [];
        
        showMessage('üßπ Interface limpa. Insira uma nova URL.', 'info');
    }
    
    function copyURL() {
        const urlInput = document.getElementById('urlInput');
        navigator.clipboard.writeText(urlInput.value)
            .then(() => showMessage('‚úÖ URL copiada para a √°rea de transfer√™ncia!', 'success'))
            .catch(() => showMessage('‚ùå Falha ao copiar URL', 'error'));
    }
    
    function formatDuration(seconds) {
        if (!seconds) return '00:00';
        const minutes = Math.floor(seconds / 60);
        const secs = seconds % 60;
        return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }
    
    // ==================== INICIALIZA√á√ÉO ====================
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üöÄ Mr.Boombastic Downloader inicializado');
        
        // Configurar eventos
        const loadBtn = document.getElementById('loadBtn');
        const urlInput = document.getElementById('urlInput');
        
        if (loadBtn) {
            loadBtn.addEventListener('click', loadVideoInfo);
        }
        
        if (urlInput) {
            urlInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    loadVideoInfo();
                }
            });
        }
        
        // Configurar filtros
        const filterButtons = document.querySelectorAll('.filter-btn');
        filterButtons.forEach(btn => {
            btn.addEventListener('click', function() {
                filterButtons.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
            });
        });
        
        // Testar API automaticamente
        setTimeout(() => {
            testAPIConnection();
        }, 1000);
        
        // Mostrar mensagem inicial
        setTimeout(() => {
            showMessage('üîç Cole uma URL do YouTube acima e clique em "Carregar Informa√ß√µes"', 'info', 8000);
        }, 2000);
    });
    
    // ==================== FUN√á√ïES GLOBAIS ====================
    window.useExample = useExample;
    window.testAPI = testAPI;
    window.clearAll = clearAll;
    window.testAllEndpoints = testAllEndpoints;
    window.downloadFormat = downloadFormat;
    window.downloadBest = downloadBest;
    window.downloadAudio = downloadAudio;
    window.convertToMP3 = convertToMP3;
    window.filterFormats = filterFormats;
    window.copyURL = copyURL;
    window.hideMessage = hideMessage;
    </script>
</body>
</html>
